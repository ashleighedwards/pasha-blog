---
import { getCollection } from 'astro:content';
import Layout from '../components/Layout.astro';

let posts = await getCollection('blog');

posts = posts.sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const backgroundImages = [
  '/circle-book1.png',
  '/line-book.png',
  '/lined-book.png'
];

const POSTS_PER_ROW = 10;
const postsWithBlanks = [];

for (let i = 0; i < posts.length; i += POSTS_PER_ROW) {
  const rowPosts = posts.slice(i, i + POSTS_PER_ROW);

  const randomIndex = Math.floor(Math.random() * (rowPosts.length + 1));
  rowPosts.splice(randomIndex, 0, { isBlank: true });

  rowPosts.forEach(post => {
    if (!post.isBlank) {
      post.bgImage = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];
    }
  });

  postsWithBlanks.push(...rowPosts);
}
---

<Layout title="My Blog">
  <div class="blog-container">
    {postsWithBlanks.map((post, index) => {
      if (post.isBlank) {
        return <div class="post-blank" key={`blank-${index}`}></div>;
      }

      return (
          <article class="post" key={post.slug} style={{backgroundImage: `url(${post.bgImage})`,
            backgroundSize: 'cover',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center' }}>
            <a href={`/blog/${post.slug}`} class="post-title">
              {post.data.title}
            </a>
          </article>
      );
    })}
  </div>
</Layout>

